on: ["workflow_dispatch"]
name: Sync
jobs:
  sync:
    strategy:
      matrix:
        go-version: [1.15.x]
        os: [ubuntu-latest]
    runs-on: ${{ matrix.os }}
    steps:
    - name: Get current date
      id: date
      run: echo "::set-output name=date::$(date +'%Y-%m-%d')"
    - name: Install Go
      uses: actions/setup-go@v2
      with:
        go-version: ${{ matrix.go-version }}
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Sync
      run: make
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v3
      with:
        branch: sync/gh
        branch-suffix: timestamp
        title: API Sync by GitHub Action (${{ steps.date.outputs.date }})
        delete-branch: true
    - name: Check outputs
      run: |
        echo "Pull Request Number - ${{ steps.cpr.outputs.pull-request-number }}"
        echo "Pull Request URL - ${{ steps.cpr.outputs.pull-request-url }}"
